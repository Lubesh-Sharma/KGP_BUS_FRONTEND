{"ast":null,"code":"var _jsxFileName = \"/home/lubesh/Desktop/DBMS/KGP_Bus/frontend/src/components/MyLocation.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport axios from 'axios';\nimport L from 'leaflet';\n\n// Fix for default marker icon in Leaflet with React\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png'\n});\nfunction MyLocation({\n  user\n}) {\n  _s();\n  const [position, setPosition] = useState(null);\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(true);\n  const mapRef = useRef();\n\n  // Use useCallback to memoize the updateLocationToServer function\n  const updateLocationToServer = useCallback(async position => {\n    try {\n      await axios.post(`${process.env.REACT_APP_API_URL}/location/update`, {\n        latitude: position.latitude,\n        longitude: position.longitude\n      }, {\n        headers: {\n          Authorization: `Bearer ${user.token}`\n        }\n      });\n    } catch (err) {\n      console.error('Error updating location:', err);\n    }\n  }, [user.token]);\n  useEffect(() => {\n    // Get current location\n    if (navigator.geolocation) {\n      const watchId = navigator.geolocation.watchPosition(position => {\n        const newPosition = {\n          latitude: position.coords.latitude,\n          longitude: position.coords.longitude\n        };\n        setPosition(newPosition);\n        setIsLoading(false);\n        updateLocationToServer(newPosition);\n      }, err => {\n        setError(`Error accessing location: ${err.message}`);\n        setIsLoading(false);\n      }, {\n        enableHighAccuracy: true,\n        timeout: 15000,\n        maximumAge: 10000\n      });\n\n      // Cleanup function to stop watching position\n      return () => navigator.geolocation.clearWatch(watchId);\n    } else {\n      setError('Geolocation is not supported by your browser');\n      setIsLoading(false);\n    }\n  }, [updateLocationToServer]); // Add updateLocationToServer as a dependency\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading your location...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 12\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: 'red',\n        padding: '20px'\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        padding: '10px 20px'\n      },\n      children: \"My Current Location\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this), position && /*#__PURE__*/_jsxDEV(MapContainer, {\n      center: [position.latitude, position.longitude],\n      zoom: 15,\n      style: {\n        height: \"calc(100vh - 100px)\"\n      },\n      ref: mapRef,\n      children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n        attribution: \"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Marker, {\n        position: [position.latitude, position.longitude],\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: [\"You are here! \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 29\n          }, this), \"Lat: \", position.latitude.toFixed(6), \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 51\n          }, this), \"Lng: \", position.longitude.toFixed(6)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n_s(MyLocation, \"wlhI4lOGeDKrohh1sleFOI1Q/yU=\");\n_c = MyLocation;\nexport default MyLocation;\nvar _c;\n$RefreshReg$(_c, \"MyLocation\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","MapContainer","TileLayer","Marker","Popup","axios","L","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","MyLocation","user","_s","position","setPosition","error","setError","isLoading","setIsLoading","mapRef","updateLocationToServer","post","process","env","REACT_APP_API_URL","latitude","longitude","headers","Authorization","token","err","console","navigator","geolocation","watchId","watchPosition","newPosition","coords","message","enableHighAccuracy","timeout","maximumAge","clearWatch","children","fileName","_jsxFileName","lineNumber","columnNumber","style","color","padding","center","zoom","height","ref","attribution","url","toFixed","_c","$RefreshReg$"],"sources":["/home/lubesh/Desktop/DBMS/KGP_Bus/frontend/src/components/MyLocation.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport axios from 'axios';\nimport L from 'leaflet';\n\n// Fix for default marker icon in Leaflet with React\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',\n});\n\nfunction MyLocation({ user }) {\n  const [position, setPosition] = useState(null);\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(true);\n  const mapRef = useRef();\n  \n  // Use useCallback to memoize the updateLocationToServer function\n  const updateLocationToServer = useCallback(async (position) => {\n    try {\n      await axios.post(\n        `${process.env.REACT_APP_API_URL}/location/update`,\n        {\n          latitude: position.latitude,\n          longitude: position.longitude,\n        },\n        {\n          headers: {\n            Authorization: `Bearer ${user.token}`,\n          },\n        }\n      );\n    } catch (err) {\n      console.error('Error updating location:', err);\n    }\n  }, [user.token]);\n  \n  useEffect(() => {\n    // Get current location\n    if (navigator.geolocation) {\n      const watchId = navigator.geolocation.watchPosition(\n        (position) => {\n          const newPosition = {\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n          };\n          setPosition(newPosition);\n          setIsLoading(false);\n          updateLocationToServer(newPosition);\n        },\n        (err) => {\n          setError(`Error accessing location: ${err.message}`);\n          setIsLoading(false);\n        },\n        { enableHighAccuracy: true, timeout: 15000, maximumAge: 10000 }\n      );\n      \n      // Cleanup function to stop watching position\n      return () => navigator.geolocation.clearWatch(watchId);\n    } else {\n      setError('Geolocation is not supported by your browser');\n      setIsLoading(false);\n    }\n  }, [updateLocationToServer]); // Add updateLocationToServer as a dependency\n\n  if (isLoading) {\n    return <div>Loading your location...</div>;\n  }\n\n  if (error) {\n    return <div style={{ color: 'red', padding: '20px' }}>{error}</div>;\n  }\n\n  return (\n    <div>\n      <h2 style={{ padding: '10px 20px' }}>My Current Location</h2>\n      {position && (\n        <MapContainer\n          center={[position.latitude, position.longitude]}\n          zoom={15}\n          style={{ height: \"calc(100vh - 100px)\" }}\n          ref={mapRef}\n        >\n          <TileLayer\n            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          />\n          <Marker position={[position.latitude, position.longitude]}>\n            <Popup>\n              You are here! <br />\n              Lat: {position.latitude.toFixed(6)} <br />\n              Lng: {position.longitude.toFixed(6)}\n            </Popup>\n          </Marker>\n        </MapContainer>\n      )}\n    </div>\n  );\n}\n\nexport default MyLocation;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}