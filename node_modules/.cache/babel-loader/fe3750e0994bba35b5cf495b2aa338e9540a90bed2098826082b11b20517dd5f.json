{"ast":null,"code":"var _jsxFileName = \"/home/lubesh/Desktop/DBMS/KGP_Bus/frontend/src/components/driver_pages/DriverMapScreen.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$(),\n  _s5 = $RefreshSig$(),\n  _s6 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap, useMapEvents } from 'react-leaflet';\nimport L from 'leaflet';\nimport axios from 'axios';\nimport { getApiUrl } from '../../utils/api2.js';\nimport '../../css/DriverMapScreen.css';\n\n// Fix for default marker icon in Leaflet with React\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png'\n});\n\n// Custom bus icon\nconst busIcon = new L.Icon({\n  iconUrl: 'https://cdn-icons-png.flaticon.com/512/30/30979.png',\n  iconSize: [40, 40],\n  iconAnchor: [20, 40],\n  popupAnchor: [0, -40]\n});\n\n// Bus stop icon\nconst busStopIcon = new L.Icon({\n  iconUrl: 'https://cdn-icons-png.flaticon.com/512/1165/1165895.png',\n  iconSize: [24, 24],\n  iconAnchor: [12, 24],\n  popupAnchor: [0, -24]\n});\n\n// Next stop icon (highlighted)\nconst nextStopIcon = new L.Icon({\n  iconUrl: 'https://cdn-icons-png.flaticon.com/512/1165/1165895.png',\n  iconSize: [36, 36],\n  iconAnchor: [18, 36],\n  popupAnchor: [0, -36],\n  className: 'next-stop-icon' // CSS class for styling\n});\n\n// Component to handle map centering\nconst MapController = ({\n  center,\n  zoom\n}) => {\n  _s();\n  const map = useMap();\n  useEffect(() => {\n    if (center) {\n      map.setView(center, zoom || map.getZoom());\n    }\n  }, [center, zoom, map]);\n  return null;\n};\n\n// Component to update driver's location in the database\n_s(MapController, \"IoceErwr5KVGS9kN4RQ1bOkYMAg=\", false, function () {\n  return [useMap];\n});\n_c = MapController;\nconst LocationUpdater = ({\n  driverId,\n  busId,\n  position\n}) => {\n  _s2();\n  useEffect(() => {\n    if (!position || !busId) return;\n    const updateLocation = async () => {\n      try {\n        await axios.post(getApiUrl('/driver/update-location'), {\n          busId,\n          latitude: position[0],\n          longitude: position[1]\n        }, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n          }\n        });\n        console.log('Location updated successfully');\n      } catch (error) {\n        console.error('Error updating location:', error);\n      }\n    };\n    updateLocation();\n\n    // Update location every 10 seconds\n    const interval = setInterval(updateLocation, 10000);\n    return () => clearInterval(interval);\n  }, [position, busId, driverId]);\n  return null;\n};\n\n// Component to draw OSRM route between stops\n_s2(LocationUpdater, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c2 = LocationUpdater;\nconst OsrmRoutes = ({\n  stops,\n  currentPosition,\n  lastClearedStopIndex,\n  nextStopIndex\n}) => {\n  _s3();\n  const map = useMap();\n  const routeRef = useRef(null);\n  const nextSegmentRef = useRef(null);\n  useEffect(() => {\n    if (!stops || stops.length < 2 || !map) return;\n    const fetchAndDrawFullRoute = async () => {\n      try {\n        // Clear previous route\n        if (routeRef.current) {\n          map.removeLayer(routeRef.current);\n          routeRef.current = null;\n        }\n\n        // Build waypoints for the complete route\n        const waypoints = stops.map(stop => [parseFloat(stop.longitude), parseFloat(stop.latitude)]);\n\n        // Close the loop for circular route\n        waypoints.push(waypoints[0]);\n\n        // Convert waypoints to the format expected by OSRM API\n        const waypointsString = waypoints.map(wp => wp.join(',')).join(';');\n        const response = await axios.get(`https://router.project-osrm.org/route/v1/driving/${waypointsString}?overview=full&geometries=geojson`);\n        if (response.data.code === 'Ok' && response.data.routes.length > 0) {\n          const routeGeometry = response.data.routes[0].geometry.coordinates;\n          // OSRM returns coordinates as [lng, lat], we need to flip for Leaflet\n          const coordinates = routeGeometry.map(coord => [coord[1], coord[0]]);\n\n          // Create a polyline for the full route\n          const polyline = L.polyline(coordinates, {\n            color: '#3388ff',\n            weight: 4,\n            opacity: 0.6,\n            lineJoin: 'round'\n          }).addTo(map);\n          routeRef.current = polyline;\n        }\n      } catch (error) {\n        console.error('Error fetching full route:', error);\n      }\n    };\n    const fetchAndDrawNextSegment = async () => {\n      try {\n        // Clear previous next segment route\n        if (nextSegmentRef.current) {\n          map.removeLayer(nextSegmentRef.current);\n          nextSegmentRef.current = null;\n        }\n\n        // Only draw if we have a last cleared stop and next stop\n        if (lastClearedStopIndex !== null && nextStopIndex !== null) {\n          const lastClearedStop = stops[lastClearedStopIndex];\n          const nextStop = stops[nextStopIndex];\n\n          // Build waypoints from last cleared stop to next stop\n          const waypoints = [[parseFloat(lastClearedStop.longitude), parseFloat(lastClearedStop.latitude)],\n          // Last cleared stop [lng, lat]\n          [parseFloat(nextStop.longitude), parseFloat(nextStop.latitude)] // Next stop [lng, lat]\n          ];\n\n          // Convert waypoints to the format expected by OSRM API\n          const waypointsString = waypoints.map(wp => wp.join(',')).join(';');\n          const response = await axios.get(`https://router.project-osrm.org/route/v1/driving/${waypointsString}?overview=full&geometries=geojson`);\n          if (response.data.code === 'Ok' && response.data.routes.length > 0) {\n            const routeGeometry = response.data.routes[0].geometry.coordinates;\n            // OSRM returns coordinates as [lng, lat], we need to flip for Leaflet\n            const coordinates = routeGeometry.map(coord => [coord[1], coord[0]]);\n\n            // Create a highlighted polyline for the next segment\n            const polyline = L.polyline(coordinates, {\n              color: '#FF0000',\n              // Red color for the highlighted segment\n              weight: 6,\n              opacity: 0.9,\n              lineJoin: 'round'\n            }).addTo(map);\n            nextSegmentRef.current = polyline;\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching next segment route:', error);\n      }\n    };\n    fetchAndDrawFullRoute();\n    fetchAndDrawNextSegment();\n\n    // Clean up function\n    return () => {\n      if (routeRef.current && map) {\n        map.removeLayer(routeRef.current);\n      }\n      if (nextSegmentRef.current && map) {\n        map.removeLayer(nextSegmentRef.current);\n      }\n    };\n  }, [map, stops, lastClearedStopIndex, nextStopIndex]); // Removed currentPosition dependency\n\n  return null;\n};\n\n// Component for tracking driver location with geolocation API\n_s3(OsrmRoutes, \"4FIBFaKyBjoe+Q6MALJXncebVEA=\", false, function () {\n  return [useMap];\n});\n_c3 = OsrmRoutes;\nconst DriverLocationTracker = ({\n  setPosition\n}) => {\n  _s4();\n  const map = useMapEvents({\n    locationfound(e) {\n      setPosition([e.latlng.lat, e.latlng.lng]);\n    },\n    locationerror(e) {\n      console.error('Location error:', e.message);\n      alert('Could not get your location. Please enable location services.');\n    }\n  });\n  useEffect(() => {\n    // Start tracking location when component mounts\n    map.locate({\n      watch: true,\n      enableHighAccuracy: true\n    });\n    return () => {\n      map.stopLocate();\n    };\n  }, [map]);\n  return null;\n};\n\n// Button to center map on driver's location\n_s4(DriverLocationTracker, \"gWh149/DLPuF22WgXAndVVlzhL4=\", false, function () {\n  return [useMapEvents];\n});\n_c4 = DriverLocationTracker;\nconst LocationButton = ({\n  position,\n  setCenter,\n  busInfo\n}) => {\n  const handleClick = () => {\n    if (position) {\n      // If we have the driver's position, center on that\n      setCenter(position);\n      console.log('Centering map on driver position:', position);\n    } else if (busInfo && busInfo.nextStop) {\n      // Fall back to the next bus stop if driver position isn't available\n      const nextStopPosition = [parseFloat(busInfo.nextStop.latitude), parseFloat(busInfo.nextStop.longitude)];\n      setCenter(nextStopPosition);\n      console.log('Centering map on next stop:', nextStopPosition);\n    } else if (busInfo && busInfo.route && busInfo.route.length > 0) {\n      // Fall back to the first stop in the route\n      const firstStopPosition = [parseFloat(busInfo.route[0].latitude), parseFloat(busInfo.route[0].longitude)];\n      setCenter(firstStopPosition);\n      console.log('Centering map on first stop in route:', firstStopPosition);\n    } else {\n      // Default to IIT KGP location\n      const defaultPosition = [22.3190, 87.3091];\n      setCenter(defaultPosition);\n      console.log('Centering map on default location:', defaultPosition);\n    }\n  };\n\n  // Always make the button clickable\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    className: \"location-button\",\n    onClick: handleClick,\n    title: position ? \"Center map on your location\" : \"Center map on route\",\n    children: [/*#__PURE__*/_jsxDEV(\"i\", {\n      className: \"fas fa-location-arrow\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }, this), \" \", position ? \"Your Location\" : \"Center Map\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 265,\n    columnNumber: 5\n  }, this);\n};\n\n// Button to mark a stop as cleared\n_c5 = LocationButton;\nconst ClearStopButton = ({\n  busId,\n  stopId,\n  onStopCleared,\n  isNextStop\n}) => {\n  _s5();\n  const [loading, setLoading] = useState(false);\n  const handleClearStop = async () => {\n    if (!busId || !stopId) return;\n    try {\n      setLoading(true);\n      const response = await axios.post(getApiUrl('/driver/clear-stop'), {\n        busId,\n        stopId\n      }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n        }\n      });\n      if (response.data) {\n        console.log('Stop cleared successfully');\n        if (onStopCleared) onStopCleared(response.data.data);\n      }\n    } catch (error) {\n      console.error('Error clearing stop:', error);\n      alert('Failed to mark stop as cleared. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  if (!isNextStop) return null;\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    className: \"clear-stop-button\",\n    onClick: handleClearStop,\n    disabled: loading,\n    children: loading ? 'Marking...' : 'Mark as Cleared'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 309,\n    columnNumber: 5\n  }, this);\n};\n_s5(ClearStopButton, \"/Rjh5rPqCCqf0XYnTUk9ZNavw3Q=\");\n_c6 = ClearStopButton;\nfunction DriverMapScreen() {\n  _s6();\n  const [position, setPosition] = useState(null);\n  const [center, setCenter] = useState(null);\n  const [busInfo, setBusInfo] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // For the map\n  const mapRef = useRef(null);\n\n  // Fetch driver's bus info and route\n  useEffect(() => {\n    const fetchDriverBus = async () => {\n      try {\n        setLoading(true);\n        const response = await axios.get(getApiUrl('/driver/my-bus'), {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n          }\n        });\n        if (response.data && response.data.data) {\n          setBusInfo(response.data.data);\n          console.log('Driver bus info loaded:', response.data.data);\n        } else {\n          setError('No bus assigned to you');\n        }\n      } catch (error) {\n        console.error('Error fetching driver bus:', error);\n        setError('Failed to load your bus information');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchDriverBus();\n\n    // Refresh bus info every 60 seconds\n    const interval = setInterval(fetchDriverBus, 60000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // Center map when position is first determined\n  useEffect(() => {\n    if (position && !center) {\n      setCenter(position);\n    }\n  }, [position, center]);\n\n  // Handle stop cleared callback\n  const handleStopCleared = updatedBus => {\n    // Update the local state with the new stops_cleared value\n    setBusInfo(prev => ({\n      ...prev,\n      bus: updatedBus,\n      stopsCleared: parseInt(updatedBus.stops_cleared)\n    }));\n\n    // Refresh the bus info to get updated last/next stop\n    const fetchDriverBus = async () => {\n      try {\n        const response = await axios.get(getApiUrl('/driver/my-bus'), {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n          }\n        });\n        if (response.data && response.data.data) {\n          setBusInfo(response.data.data);\n        }\n      } catch (error) {\n        console.error('Error refreshing driver bus info:', error);\n      }\n    };\n    fetchDriverBus();\n  };\n\n  // Find indices for last cleared stop and next stop\n  const getStopIndices = () => {\n    if (!busInfo || !busInfo.route || busInfo.route.length === 0) {\n      return {\n        lastClearedStopIndex: null,\n        nextStopIndex: null\n      };\n    }\n    const stops = busInfo.route;\n    const stopsCleared = busInfo.stopsCleared || 0;\n\n    // If stopsCleared is 0, the last cleared stop is the last one in the route (circular)\n    // and the next stop is the first in the route\n    if (stopsCleared === 0) {\n      return {\n        lastClearedStopIndex: stops.length - 1,\n        nextStopIndex: 0\n      };\n    }\n\n    // Normalize stopsCleared to be within the route length (for circular routes)\n    const normalizedStopsCleared = stopsCleared % stops.length;\n    return {\n      lastClearedStopIndex: normalizedStopsCleared - 1,\n      nextStopIndex: normalizedStopsCleared % stops.length\n    };\n  };\n  const {\n    lastClearedStopIndex,\n    nextStopIndex\n  } = getStopIndices();\n\n  // If still loading, show a spinner\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"driver-map-loading\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading your bus information...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 439,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 7\n    }, this);\n  }\n\n  // If there's an error, show error message\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"driver-map-error\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 448,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 449,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.location.reload(),\n        children: \"Retry\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 450,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 7\n    }, this);\n  }\n\n  // If no bus assigned, show message\n  if (!busInfo || !busInfo.bus) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"driver-map-error\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"No Bus Assigned\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 459,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"You do not have a bus assigned to you. Please contact an administrator.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"driver-map-screen\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"driver-map-container\",\n      children: [/*#__PURE__*/_jsxDEV(MapContainer, {\n        center: center || [22.3190, 87.3091] // Default to IIT KGP if no position yet\n        ,\n        zoom: 15,\n        className: \"driver-map\",\n        ref: mapRef,\n        children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n          attribution: \"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",\n          url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 474,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MapController, {\n          center: center,\n          zoom: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(DriverLocationTracker, {\n          setPosition: setPosition\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 11\n        }, this), position && busInfo && /*#__PURE__*/_jsxDEV(LocationUpdater, {\n          driverId: localStorage.getItem('userId'),\n          busId: busInfo.bus.id,\n          position: position\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 487,\n          columnNumber: 13\n        }, this), position && /*#__PURE__*/_jsxDEV(Marker, {\n          position: position,\n          icon: busIcon,\n          children: /*#__PURE__*/_jsxDEV(Popup, {\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"driver-popup\",\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: [\"Your Location (Bus \", busInfo.bus.name, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 499,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"You are here.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 500,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 498,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 497,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 13\n        }, this), busInfo && busInfo.route && busInfo.route.map((stop, index) => /*#__PURE__*/_jsxDEV(Marker, {\n          position: [parseFloat(stop.latitude), parseFloat(stop.longitude)],\n          icon: index === nextStopIndex ? nextStopIcon : busStopIcon,\n          children: /*#__PURE__*/_jsxDEV(Popup, {\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"stop-popup\",\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: stop.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 515,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Stop #\", index + 1, \" in route\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 516,\n                columnNumber: 19\n              }, this), index === nextStopIndex && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"next-stop-label\",\n                  children: \"This is your next stop\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 519,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(ClearStopButton, {\n                  busId: busInfo.bus.id,\n                  stopId: stop.stop_id,\n                  onStopCleared: handleStopCleared,\n                  isNextStop: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 520,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 514,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 513,\n            columnNumber: 15\n          }, this)\n        }, stop.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 508,\n          columnNumber: 13\n        }, this)), busInfo && busInfo.route && position && /*#__PURE__*/_jsxDEV(OsrmRoutes, {\n          stops: busInfo.route,\n          currentPosition: position,\n          lastClearedStopIndex: lastClearedStopIndex,\n          nextStopIndex: nextStopIndex\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(LocationButton, {\n        position: position,\n        setCenter: setCenter,\n        busInfo: busInfo\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 545,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bus-info-panel\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [\"Bus: \", busInfo.bus.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 11\n        }, this), busInfo.nextStop && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"next-stop-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Next Stop:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 556,\n              columnNumber: 18\n            }, this), \" \", busInfo.nextStop.name]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 556,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ClearStopButton, {\n            busId: busInfo.bus.id,\n            stopId: busInfo.nextStop.stop_id,\n            onStopCleared: handleStopCleared,\n            isNextStop: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 557,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 555,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 552,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 466,\n    columnNumber: 5\n  }, this);\n}\n_s6(DriverMapScreen, \"J6kS74zQ+7p4G5RLSKbt38EOs3k=\");\n_c7 = DriverMapScreen;\nexport default DriverMapScreen;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n$RefreshReg$(_c, \"MapController\");\n$RefreshReg$(_c2, \"LocationUpdater\");\n$RefreshReg$(_c3, \"OsrmRoutes\");\n$RefreshReg$(_c4, \"DriverLocationTracker\");\n$RefreshReg$(_c5, \"LocationButton\");\n$RefreshReg$(_c6, \"ClearStopButton\");\n$RefreshReg$(_c7, \"DriverMapScreen\");","map":{"version":3,"names":["React","useState","useEffect","useRef","MapContainer","TileLayer","Marker","Popup","useMap","useMapEvents","L","axios","getApiUrl","jsxDEV","_jsxDEV","Fragment","_Fragment","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","busIcon","iconSize","iconAnchor","popupAnchor","busStopIcon","nextStopIcon","className","MapController","center","zoom","_s","map","setView","getZoom","_c","LocationUpdater","driverId","busId","position","_s2","updateLocation","post","latitude","longitude","headers","Authorization","localStorage","getItem","console","log","error","interval","setInterval","clearInterval","_c2","OsrmRoutes","stops","currentPosition","lastClearedStopIndex","nextStopIndex","_s3","routeRef","nextSegmentRef","length","fetchAndDrawFullRoute","current","removeLayer","waypoints","stop","parseFloat","push","waypointsString","wp","join","response","get","data","code","routes","routeGeometry","geometry","coordinates","coord","polyline","color","weight","opacity","lineJoin","addTo","fetchAndDrawNextSegment","lastClearedStop","nextStop","_c3","DriverLocationTracker","setPosition","_s4","locationfound","e","latlng","lat","lng","locationerror","message","alert","locate","watch","enableHighAccuracy","stopLocate","_c4","LocationButton","setCenter","busInfo","handleClick","nextStopPosition","route","firstStopPosition","defaultPosition","onClick","title","children","fileName","_jsxFileName","lineNumber","columnNumber","_c5","ClearStopButton","stopId","onStopCleared","isNextStop","_s5","loading","setLoading","handleClearStop","disabled","_c6","DriverMapScreen","_s6","setBusInfo","setError","mapRef","fetchDriverBus","handleStopCleared","updatedBus","prev","bus","stopsCleared","parseInt","stops_cleared","getStopIndices","normalizedStopsCleared","window","location","reload","ref","attribution","url","id","icon","name","index","stop_id","_c7","$RefreshReg$"],"sources":["/home/lubesh/Desktop/DBMS/KGP_Bus/frontend/src/components/driver_pages/DriverMapScreen.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap, useMapEvents } from 'react-leaflet';\nimport L from 'leaflet';\nimport axios from 'axios';\nimport { getApiUrl } from '../../utils/api2.js';\nimport '../../css/DriverMapScreen.css';\n\n// Fix for default marker icon in Leaflet with React\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',\n});\n\n// Custom bus icon\nconst busIcon = new L.Icon({\n  iconUrl: 'https://cdn-icons-png.flaticon.com/512/30/30979.png',\n  iconSize: [40, 40],\n  iconAnchor: [20, 40],\n  popupAnchor: [0, -40]\n});\n\n// Bus stop icon\nconst busStopIcon = new L.Icon({\n  iconUrl: 'https://cdn-icons-png.flaticon.com/512/1165/1165895.png',\n  iconSize: [24, 24],\n  iconAnchor: [12, 24],\n  popupAnchor: [0, -24]\n});\n\n// Next stop icon (highlighted)\nconst nextStopIcon = new L.Icon({\n  iconUrl: 'https://cdn-icons-png.flaticon.com/512/1165/1165895.png',\n  iconSize: [36, 36],\n  iconAnchor: [18, 36],\n  popupAnchor: [0, -36],\n  className: 'next-stop-icon' // CSS class for styling\n});\n\n// Component to handle map centering\nconst MapController = ({ center, zoom }) => {\n  const map = useMap();\n  \n  useEffect(() => {\n    if (center) {\n      map.setView(center, zoom || map.getZoom());\n    }\n  }, [center, zoom, map]);\n  \n  return null;\n};\n\n// Component to update driver's location in the database\nconst LocationUpdater = ({ driverId, busId, position }) => {\n  useEffect(() => {\n    if (!position || !busId) return;\n\n    const updateLocation = async () => {\n      try {\n        await axios.post(\n          getApiUrl('/driver/update-location'),\n          {\n            busId,\n            latitude: position[0],\n            longitude: position[1]\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n            }\n          }\n        );\n        console.log('Location updated successfully');\n      } catch (error) {\n        console.error('Error updating location:', error);\n      }\n    };\n\n    updateLocation();\n    \n    // Update location every 10 seconds\n    const interval = setInterval(updateLocation, 10000);\n    \n    return () => clearInterval(interval);\n  }, [position, busId, driverId]);\n  \n  return null;\n};\n\n// Component to draw OSRM route between stops\nconst OsrmRoutes = ({ stops, currentPosition, lastClearedStopIndex, nextStopIndex }) => {\n  const map = useMap();\n  const routeRef = useRef(null);\n  const nextSegmentRef = useRef(null);\n  \n  useEffect(() => {\n    if (!stops || stops.length < 2 || !map) return;\n    \n    const fetchAndDrawFullRoute = async () => {\n      try {\n        // Clear previous route\n        if (routeRef.current) {\n          map.removeLayer(routeRef.current);\n          routeRef.current = null;\n        }\n        \n        // Build waypoints for the complete route\n        const waypoints = stops.map(stop => [\n          parseFloat(stop.longitude), \n          parseFloat(stop.latitude)\n        ]);\n        \n        // Close the loop for circular route\n        waypoints.push(waypoints[0]);\n        \n        // Convert waypoints to the format expected by OSRM API\n        const waypointsString = waypoints.map(wp => wp.join(',')).join(';');\n        \n        const response = await axios.get(\n          `https://router.project-osrm.org/route/v1/driving/${waypointsString}?overview=full&geometries=geojson`\n        );\n        \n        if (response.data.code === 'Ok' && response.data.routes.length > 0) {\n          const routeGeometry = response.data.routes[0].geometry.coordinates;\n          // OSRM returns coordinates as [lng, lat], we need to flip for Leaflet\n          const coordinates = routeGeometry.map(coord => [coord[1], coord[0]]);\n          \n          // Create a polyline for the full route\n          const polyline = L.polyline(coordinates, {\n            color: '#3388ff',\n            weight: 4,\n            opacity: 0.6,\n            lineJoin: 'round'\n          }).addTo(map);\n          \n          routeRef.current = polyline;\n        }\n      } catch (error) {\n        console.error('Error fetching full route:', error);\n      }\n    };\n    \n    const fetchAndDrawNextSegment = async () => {\n      try {\n        // Clear previous next segment route\n        if (nextSegmentRef.current) {\n          map.removeLayer(nextSegmentRef.current);\n          nextSegmentRef.current = null;\n        }\n        \n        // Only draw if we have a last cleared stop and next stop\n        if (lastClearedStopIndex !== null && nextStopIndex !== null) {\n          const lastClearedStop = stops[lastClearedStopIndex];\n          const nextStop = stops[nextStopIndex];\n          \n          // Build waypoints from last cleared stop to next stop\n          const waypoints = [\n            [parseFloat(lastClearedStop.longitude), parseFloat(lastClearedStop.latitude)], // Last cleared stop [lng, lat]\n            [parseFloat(nextStop.longitude), parseFloat(nextStop.latitude)] // Next stop [lng, lat]\n          ];\n          \n          // Convert waypoints to the format expected by OSRM API\n          const waypointsString = waypoints.map(wp => wp.join(',')).join(';');\n          \n          const response = await axios.get(\n            `https://router.project-osrm.org/route/v1/driving/${waypointsString}?overview=full&geometries=geojson`\n          );\n          \n          if (response.data.code === 'Ok' && response.data.routes.length > 0) {\n            const routeGeometry = response.data.routes[0].geometry.coordinates;\n            // OSRM returns coordinates as [lng, lat], we need to flip for Leaflet\n            const coordinates = routeGeometry.map(coord => [coord[1], coord[0]]);\n            \n            // Create a highlighted polyline for the next segment\n            const polyline = L.polyline(coordinates, {\n              color: '#FF0000', // Red color for the highlighted segment\n              weight: 6,\n              opacity: 0.9,\n              lineJoin: 'round'\n            }).addTo(map);\n            \n            nextSegmentRef.current = polyline;\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching next segment route:', error);\n      }\n    };\n    \n    fetchAndDrawFullRoute();\n    fetchAndDrawNextSegment();\n    \n    // Clean up function\n    return () => {\n      if (routeRef.current && map) {\n        map.removeLayer(routeRef.current);\n      }\n      if (nextSegmentRef.current && map) {\n        map.removeLayer(nextSegmentRef.current);\n      }\n    };\n  }, [map, stops, lastClearedStopIndex, nextStopIndex]); // Removed currentPosition dependency\n  \n  return null;\n};\n\n// Component for tracking driver location with geolocation API\nconst DriverLocationTracker = ({ setPosition }) => {\n  const map = useMapEvents({\n    locationfound(e) {\n      setPosition([e.latlng.lat, e.latlng.lng]);\n    },\n    locationerror(e) {\n      console.error('Location error:', e.message);\n      alert('Could not get your location. Please enable location services.');\n    }\n  });\n  \n  useEffect(() => {\n    // Start tracking location when component mounts\n    map.locate({ watch: true, enableHighAccuracy: true });\n    \n    return () => {\n      map.stopLocate();\n    };\n  }, [map]);\n  \n  return null;\n};\n\n// Button to center map on driver's location\nconst LocationButton = ({ position, setCenter, busInfo }) => {\n  const handleClick = () => {\n    if (position) {\n      // If we have the driver's position, center on that\n      setCenter(position);\n      console.log('Centering map on driver position:', position);\n    } else if (busInfo && busInfo.nextStop) {\n      // Fall back to the next bus stop if driver position isn't available\n      const nextStopPosition = [\n        parseFloat(busInfo.nextStop.latitude),\n        parseFloat(busInfo.nextStop.longitude)\n      ];\n      setCenter(nextStopPosition);\n      console.log('Centering map on next stop:', nextStopPosition);\n    } else if (busInfo && busInfo.route && busInfo.route.length > 0) {\n      // Fall back to the first stop in the route\n      const firstStopPosition = [\n        parseFloat(busInfo.route[0].latitude),\n        parseFloat(busInfo.route[0].longitude)\n      ];\n      setCenter(firstStopPosition);\n      console.log('Centering map on first stop in route:', firstStopPosition);\n    } else {\n      // Default to IIT KGP location\n      const defaultPosition = [22.3190, 87.3091];\n      setCenter(defaultPosition);\n      console.log('Centering map on default location:', defaultPosition);\n    }\n  };\n  \n  // Always make the button clickable\n  return (\n    <button \n      className=\"location-button\" \n      onClick={handleClick} \n      title={position ? \"Center map on your location\" : \"Center map on route\"}\n    >\n      <i className=\"fas fa-location-arrow\"></i> {position ? \"Your Location\" : \"Center Map\"}\n    </button>\n  );\n};\n\n// Button to mark a stop as cleared\nconst ClearStopButton = ({ busId, stopId, onStopCleared, isNextStop }) => {\n  const [loading, setLoading] = useState(false);\n  \n  const handleClearStop = async () => {\n    if (!busId || !stopId) return;\n    \n    try {\n      setLoading(true);\n      const response = await axios.post(\n        getApiUrl('/driver/clear-stop'),\n        { busId, stopId },\n        {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n          }\n        }\n      );\n      \n      if (response.data) {\n        console.log('Stop cleared successfully');\n        if (onStopCleared) onStopCleared(response.data.data);\n      }\n    } catch (error) {\n      console.error('Error clearing stop:', error);\n      alert('Failed to mark stop as cleared. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  if (!isNextStop) return null;\n  \n  return (\n    <button \n      className=\"clear-stop-button\" \n      onClick={handleClearStop} \n      disabled={loading}\n    >\n      {loading ? 'Marking...' : 'Mark as Cleared'}\n    </button>\n  );\n};\n\nfunction DriverMapScreen() {\n  const [position, setPosition] = useState(null);\n  const [center, setCenter] = useState(null);\n  const [busInfo, setBusInfo] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  \n  // For the map\n  const mapRef = useRef(null);\n  \n  // Fetch driver's bus info and route\n  useEffect(() => {\n    const fetchDriverBus = async () => {\n      try {\n        setLoading(true);\n        \n        const response = await axios.get(\n          getApiUrl('/driver/my-bus'),\n          {\n            headers: {\n              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n            }\n          }\n        );\n        \n        if (response.data && response.data.data) {\n          setBusInfo(response.data.data);\n          console.log('Driver bus info loaded:', response.data.data);\n        } else {\n          setError('No bus assigned to you');\n        }\n      } catch (error) {\n        console.error('Error fetching driver bus:', error);\n        setError('Failed to load your bus information');\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchDriverBus();\n    \n    // Refresh bus info every 60 seconds\n    const interval = setInterval(fetchDriverBus, 60000);\n    \n    return () => clearInterval(interval);\n  }, []);  \n  \n  // Center map when position is first determined\n  useEffect(() => {\n    if (position && !center) {\n      setCenter(position);\n    }\n  }, [position, center]);\n  \n  // Handle stop cleared callback\n  const handleStopCleared = (updatedBus) => {\n    // Update the local state with the new stops_cleared value\n    setBusInfo(prev => ({\n      ...prev,\n      bus: updatedBus,\n      stopsCleared: parseInt(updatedBus.stops_cleared)\n    }));\n    \n    // Refresh the bus info to get updated last/next stop\n    const fetchDriverBus = async () => {\n      try {\n        const response = await axios.get(\n          getApiUrl('/driver/my-bus'),\n          {\n            headers: {\n              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`\n            }\n          }\n        );\n        \n        if (response.data && response.data.data) {\n          setBusInfo(response.data.data);\n        }\n      } catch (error) {\n        console.error('Error refreshing driver bus info:', error);\n      }\n    };\n    \n    fetchDriverBus();\n  };\n  \n  // Find indices for last cleared stop and next stop\n  const getStopIndices = () => {\n    if (!busInfo || !busInfo.route || busInfo.route.length === 0) {\n      return { lastClearedStopIndex: null, nextStopIndex: null };\n    }\n    \n    const stops = busInfo.route;\n    const stopsCleared = busInfo.stopsCleared || 0;\n    \n    // If stopsCleared is 0, the last cleared stop is the last one in the route (circular)\n    // and the next stop is the first in the route\n    if (stopsCleared === 0) {\n      return {\n        lastClearedStopIndex: stops.length - 1,\n        nextStopIndex: 0\n      };\n    }\n    \n    // Normalize stopsCleared to be within the route length (for circular routes)\n    const normalizedStopsCleared = stopsCleared % stops.length;\n    \n    return {\n      lastClearedStopIndex: normalizedStopsCleared - 1,\n      nextStopIndex: normalizedStopsCleared % stops.length\n    };\n  };\n  \n  const { lastClearedStopIndex, nextStopIndex } = getStopIndices();  \n  \n  // If still loading, show a spinner\n  if (loading) {\n    return (\n      <div className=\"driver-map-loading\">\n        <div className=\"spinner\"></div>\n        <p>Loading your bus information...</p>\n      </div>\n    );\n  }\n  \n  // If there's an error, show error message\n  if (error) {\n    return (\n      <div className=\"driver-map-error\">\n        <h2>Error</h2>\n        <p>{error}</p>\n        <button onClick={() => window.location.reload()}>Retry</button>\n      </div>\n    );\n  }\n  \n  // If no bus assigned, show message\n  if (!busInfo || !busInfo.bus) {\n    return (\n      <div className=\"driver-map-error\">\n        <h2>No Bus Assigned</h2>\n        <p>You do not have a bus assigned to you. Please contact an administrator.</p>\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"driver-map-screen\">\n      <div className=\"driver-map-container\">\n        <MapContainer\n          center={center || [22.3190, 87.3091]} // Default to IIT KGP if no position yet\n          zoom={15}\n          className=\"driver-map\"\n          ref={mapRef}\n        >\n          <TileLayer\n            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          />\n          \n          {/* Map controller to center map */}\n          <MapController center={center} zoom={15} />\n          \n          {/* Driver location tracker */}\n          <DriverLocationTracker setPosition={setPosition} />\n          \n          {/* Location updater component */}\n          {position && busInfo && (\n            <LocationUpdater\n              driverId={localStorage.getItem('userId')}\n              busId={busInfo.bus.id}\n              position={position}\n            />\n          )}\n          \n          {/* Driver marker */}\n          {position && (\n            <Marker position={position} icon={busIcon}>\n              <Popup>\n                <div className=\"driver-popup\">\n                  <strong>Your Location (Bus {busInfo.bus.name})</strong>\n                  <p>You are here.</p>\n                </div>\n              </Popup>\n            </Marker>\n          )}\n          \n          {/* Show all stops in the route */}\n          {busInfo && busInfo.route && busInfo.route.map((stop, index) => (\n            <Marker\n              key={stop.id}\n              position={[parseFloat(stop.latitude), parseFloat(stop.longitude)]}\n              icon={index === nextStopIndex ? nextStopIcon : busStopIcon}\n            >\n              <Popup>\n                <div className=\"stop-popup\">\n                  <strong>{stop.name}</strong>\n                  <p>Stop #{index + 1} in route</p>\n                  {index === nextStopIndex && (\n                    <>\n                      <p className=\"next-stop-label\">This is your next stop</p>\n                      <ClearStopButton\n                        busId={busInfo.bus.id}\n                        stopId={stop.stop_id}\n                        onStopCleared={handleStopCleared}\n                        isNextStop={true}\n                      />\n                    </>\n                  )}\n                </div>\n              </Popup>\n            </Marker>\n          ))}\n          \n          {/* OSRM routes */}\n          {busInfo && busInfo.route && position && (\n            <OsrmRoutes\n              stops={busInfo.route}\n              currentPosition={position}\n              lastClearedStopIndex={lastClearedStopIndex}\n              nextStopIndex={nextStopIndex}\n            />\n          )}\n        </MapContainer>\n        \n        {/* Location button outside map - now always visible */}\n        <LocationButton \n          position={position} \n          setCenter={setCenter} \n          busInfo={busInfo} \n        />\n        \n        {/* Bus info panel */}\n        <div className=\"bus-info-panel\">\n          <h3>Bus: {busInfo.bus.name}</h3>\n          {busInfo.nextStop && (\n            <div className=\"next-stop-info\">\n              <p><strong>Next Stop:</strong> {busInfo.nextStop.name}</p>\n              <ClearStopButton\n                busId={busInfo.bus.id}\n                stopId={busInfo.nextStop.stop_id}\n                onStopCleared={handleStopCleared}\n                isNextStop={true}\n              />\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default DriverMapScreen;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}