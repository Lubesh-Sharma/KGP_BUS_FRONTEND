{"ast":null,"code":"var _jsxFileName = \"/home/lubesh/Desktop/DBMS/KGP_Bus/frontend/src/components/admin/UserLocations.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport axios from 'axios';\nimport L from 'leaflet';\nimport api, { getApiUrl } from '../../utils/api2.js';\n\n// Fix for default marker icon in Leaflet with React\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png'\n});\n\n// Create different icons for different user types\nconst createIcon = userType => {\n  const iconUrl = userType === 'driver' ? 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png' : userType === 'admin' ? 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png' : 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png';\n  return L.icon({\n    iconUrl,\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\n    iconSize: [25, 41],\n    iconAnchor: [12, 41],\n    popupAnchor: [1, -34],\n    shadowSize: [41, 41]\n  });\n};\nfunction UserLocations({\n  user\n}) {\n  _s();\n  const [rawLocations, setRawLocations] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [filterText, setFilterText] = useState('');\n  const [mapCenter, setMapCenter] = useState([22.3190, 87.3091]); // Default IIT KGP coordinates\n  const [lastRefresh, setLastRefresh] = useState(new Date());\n  const mapRef = useRef(null);\n\n  // Process raw locations to get only the most recent location for each user\n  const locations = useMemo(() => {\n    // Group by user_id and keep only most recent entry\n    const userMap = new Map();\n    rawLocations.forEach(location => {\n      // Handle different possible ID keys in the data\n      const userId = location.user_id || location.id;\n      if (!userId) return; // Skip entries without a valid user ID\n\n      if (!userMap.has(userId) || new Date(location.timestamp) > new Date(userMap.get(userId).timestamp)) {\n        userMap.set(userId, location);\n      }\n    });\n    return Array.from(userMap.values());\n  }, [rawLocations]);\n  const fetchUserLocations = async () => {\n    try {\n      setLoading(true);\n      setError('');\n      const response = await axios.get(getApiUrl(api.endpoints.adminUserLocations), {\n        headers: {\n          Authorization: `Bearer ${user.token}`\n        }\n      });\n      if (response.data && Array.isArray(response.data)) {\n        console.log('User locations loaded:', response.data.length);\n        setRawLocations(response.data);\n        setLastRefresh(new Date());\n        if (response.data.length > 0 && mapRef.current) {\n          // Find a suitable center point for the map\n          const validLocations = response.data.filter(loc => loc && loc.latitude && loc.longitude);\n          if (validLocations.length > 0) {\n            var _firstLocation$coordi, _firstLocation$coordi2;\n            const firstLocation = validLocations[0];\n            setMapCenter([firstLocation.latitude || ((_firstLocation$coordi = firstLocation.coordinates) === null || _firstLocation$coordi === void 0 ? void 0 : _firstLocation$coordi.latitude), firstLocation.longitude || ((_firstLocation$coordi2 = firstLocation.coordinates) === null || _firstLocation$coordi2 === void 0 ? void 0 : _firstLocation$coordi2.longitude)]);\n          }\n        }\n      } else {\n        console.warn(\"Unexpected response format:\", response.data);\n        setRawLocations([]);\n      }\n    } catch (err) {\n      setError('Failed to fetch user locations: ' + err.message);\n      console.error('Error fetching user locations:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Initial fetch\n  useEffect(() => {\n    fetchUserLocations();\n\n    // Set up refresh interval - refresh every 30 seconds\n    const interval = setInterval(fetchUserLocations, 30000);\n\n    // Clean up interval on unmount\n    return () => {\n      if (interval) {\n        clearInterval(interval);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user.token]);\n\n  // Filter locations based on search text - ensure we check all possible fields\n  const filteredLocations = locations.filter(location => {\n    var _location$username, _location$user_name, _location$email, _location$fullName, _location$role, _location$type;\n    const searchText = filterText.toLowerCase();\n\n    // Check all possible name/identifier fields in the data\n    return (((_location$username = location.username) === null || _location$username === void 0 ? void 0 : _location$username.toLowerCase()) || '').includes(searchText) || (((_location$user_name = location.user_name) === null || _location$user_name === void 0 ? void 0 : _location$user_name.toLowerCase()) || '').includes(searchText) || (((_location$email = location.email) === null || _location$email === void 0 ? void 0 : _location$email.toLowerCase()) || '').includes(searchText) || (((_location$fullName = location.fullName) === null || _location$fullName === void 0 ? void 0 : _location$fullName.toLowerCase()) || '').includes(searchText) || (((_location$role = location.role) === null || _location$role === void 0 ? void 0 : _location$role.toLowerCase()) || '').includes(searchText) || (((_location$type = location.type) === null || _location$type === void 0 ? void 0 : _location$type.toLowerCase()) || '').includes(searchText);\n  });\n\n  // Calculate statistics with better role detection\n  const userCounts = {\n    total: filteredLocations.length,\n    drivers: filteredLocations.filter(loc => {\n      const role = loc.role || loc.type || '';\n      return role.toLowerCase() === 'driver';\n    }).length,\n    users: filteredLocations.filter(loc => {\n      const role = loc.role || loc.type || '';\n      return role.toLowerCase() === 'user' || role === '';\n    }).length,\n    admins: filteredLocations.filter(loc => {\n      const role = loc.role || loc.type || '';\n      return role.toLowerCase() === 'admin';\n    }).length\n  };\n\n  // Format timestamp in a readable way\n  const formatTimestamp = timestamp => {\n    if (!timestamp) return 'Unknown';\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMinutes = Math.floor((now - date) / (1000 * 60));\n    if (diffMinutes < 1) return 'Just now';\n    if (diffMinutes < 60) return `${diffMinutes} minute${diffMinutes === 1 ? '' : 's'} ago`;\n    const diffHours = Math.floor(diffMinutes / 60);\n    if (diffHours < 24) return `${diffHours} hour${diffHours === 1 ? '' : 's'} ago`;\n    const diffDays = Math.floor(diffHours / 24);\n    if (diffDays < 7) return `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;\n    return date.toLocaleDateString() + ' at ' + date.toLocaleTimeString();\n  };\n\n  // Get the right marker coordinates regardless of data format\n  const getMarkerCoordinates = location => {\n    // Handle different possible data formats\n    if (location.coordinates) {\n      return [location.coordinates.latitude || location.coordinates.lat, location.coordinates.longitude || location.coordinates.lng];\n    } else {\n      return [location.latitude, location.longitude];\n    }\n  };\n\n  // Get the status of the location based on timestamp\n  const getLocationStatus = timestamp => {\n    if (!timestamp) return 'unknown';\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMinutes = Math.floor((now - date) / (1000 * 60));\n    if (diffMinutes < 15) return 'active';\n    if (diffMinutes < 60) return 'recent';\n    if (diffMinutes < 24 * 60) return 'today';\n    return 'old';\n  };\n\n  // Get the right user role regardless of data format\n  const getUserRole = location => {\n    const role = location.role || location.type || 'user';\n    return role.toLowerCase();\n  };\n  if (loading && locations.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading user locations...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"user-locations\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"User Location Tracking\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"action-buttons\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: fetchUserLocations,\n        disabled: loading,\n        className: \"refresh-button\",\n        children: loading ? 'Refreshing...' : 'Refresh Data'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"last-updated\",\n      children: [\"Last updated: \", formatTimestamp(lastRefresh)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"filter-container\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Filter by name, email or type...\",\n        value: filterText,\n        onChange: e => setFilterText(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 7\n    }, this), filteredLocations.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"map-container\",\n      children: /*#__PURE__*/_jsxDEV(MapContainer, {\n        center: mapCenter,\n        zoom: 15,\n        style: {\n          height: \"500px\",\n          width: \"100%\"\n        },\n        ref: mapRef,\n        children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n          attribution: \"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",\n          url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 13\n        }, this), filteredLocations.map(location => {\n          const role = getUserRole(location);\n          const coordinates = getMarkerCoordinates(location);\n\n          // Only show marker if we have valid coordinates\n          if (coordinates[0] && coordinates[1] && !isNaN(coordinates[0]) && !isNaN(coordinates[1])) {\n            return /*#__PURE__*/_jsxDEV(Marker, {\n              position: coordinates,\n              icon: createIcon(role),\n              children: /*#__PURE__*/_jsxDEV(Popup, {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"location-popup\",\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: location.username || location.user_name || 'Unknown User'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 283,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"Role: \", role]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 284,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"Last seen: \", formatTimestamp(location.timestamp)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 285,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"Coordinates: \", coordinates[0].toFixed(6), \", \", coordinates[1].toFixed(6)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 286,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 282,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 21\n              }, this)\n            }, location.id || location.user_id || location._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 19\n            }, this);\n          }\n          return null;\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"no-locations\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No user locations found matching your search criteria.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"users-table\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"User Location Details \", filteredLocations.length > 0 && `(${filteredLocations.length})`]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 9\n      }, this), filteredLocations.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No user locations found matching your search criteria.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"table\", {\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Username\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Email\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Role\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Last Updated\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Status\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Coordinates\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: filteredLocations.map(location => {\n            const role = getUserRole(location);\n            const coordinates = getMarkerCoordinates(location);\n            const status = getLocationStatus(location.timestamp);\n            return /*#__PURE__*/_jsxDEV(\"tr\", {\n              className: `status-${status} role-${role}`,\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: location.username || location.user_name || 'Unknown'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: location.email || location.fullName || 'Not provided'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 328,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `role-badge role-${role}`,\n                  children: role\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 330,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 329,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: formatTimestamp(location.timestamp)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 332,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `status-indicator ${status}`,\n                  children: status === 'active' ? 'Active now' : status === 'recent' ? 'Recently active' : status === 'today' ? 'Active today' : 'Not recent'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 334,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 333,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: coordinates[0] && coordinates[1] ? `${coordinates[0].toFixed(6)}, ${coordinates[1].toFixed(6)}` : 'Invalid coordinates'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 340,\n                columnNumber: 21\n              }, this)]\n            }, location.id || location.user_id || location._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 19\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 209,\n    columnNumber: 5\n  }, this);\n}\n_s(UserLocations, \"xgcyxe+8AEn3tncXk5cuW5hFrkA=\");\n_c = UserLocations;\nexport default UserLocations;\nvar _c;\n$RefreshReg$(_c, \"UserLocations\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","MapContainer","TileLayer","Marker","Popup","axios","L","api","getApiUrl","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","createIcon","userType","icon","iconSize","iconAnchor","popupAnchor","shadowSize","UserLocations","user","_s","rawLocations","setRawLocations","loading","setLoading","error","setError","filterText","setFilterText","mapCenter","setMapCenter","lastRefresh","setLastRefresh","Date","mapRef","locations","userMap","Map","forEach","location","userId","user_id","id","has","timestamp","get","set","Array","from","values","fetchUserLocations","response","endpoints","adminUserLocations","headers","Authorization","token","data","isArray","console","log","length","current","validLocations","filter","loc","latitude","longitude","_firstLocation$coordi","_firstLocation$coordi2","firstLocation","coordinates","warn","err","message","interval","setInterval","clearInterval","filteredLocations","_location$username","_location$user_name","_location$email","_location$fullName","_location$role","_location$type","searchText","toLowerCase","username","includes","user_name","email","fullName","role","type","userCounts","total","drivers","users","admins","formatTimestamp","date","now","diffMinutes","Math","floor","diffHours","diffDays","toLocaleDateString","toLocaleTimeString","getMarkerCoordinates","lat","lng","getLocationStatus","getUserRole","children","fileName","_jsxFileName","lineNumber","columnNumber","className","onClick","disabled","placeholder","value","onChange","e","target","center","zoom","style","height","width","ref","attribution","url","map","isNaN","position","toFixed","_id","status","_c","$RefreshReg$"],"sources":["/home/lubesh/Desktop/DBMS/KGP_Bus/frontend/src/components/admin/UserLocations.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\r\nimport axios from 'axios';\r\nimport L from 'leaflet';\r\nimport api, { getApiUrl } from '../../utils/api2.js';\r\n\r\n// Fix for default marker icon in Leaflet with React\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\r\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\r\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',\r\n});\r\n\r\n// Create different icons for different user types\r\nconst createIcon = (userType) => {\r\n  const iconUrl = userType === 'driver' ? \r\n    'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png' : \r\n    userType === 'admin' ?\r\n    'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png' :\r\n    'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png';\r\n  \r\n  return L.icon({\r\n    iconUrl,\r\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41],\r\n    popupAnchor: [1, -34],\r\n    shadowSize: [41, 41]\r\n  });\r\n};\r\n\r\nfunction UserLocations({ user }) {\r\n  const [rawLocations, setRawLocations] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [filterText, setFilterText] = useState('');\r\n  const [mapCenter, setMapCenter] = useState([22.3190, 87.3091]); // Default IIT KGP coordinates\r\n  const [lastRefresh, setLastRefresh] = useState(new Date());\r\n  const mapRef = useRef(null);\r\n  \r\n  // Process raw locations to get only the most recent location for each user\r\n  const locations = useMemo(() => {\r\n    // Group by user_id and keep only most recent entry\r\n    const userMap = new Map();\r\n    \r\n    rawLocations.forEach(location => {\r\n      // Handle different possible ID keys in the data\r\n      const userId = location.user_id || location.id;\r\n      \r\n      if (!userId) return; // Skip entries without a valid user ID\r\n      \r\n      if (!userMap.has(userId) || \r\n          new Date(location.timestamp) > new Date(userMap.get(userId).timestamp)) {\r\n        userMap.set(userId, location);\r\n      }\r\n    });\r\n    \r\n    return Array.from(userMap.values());\r\n  }, [rawLocations]);\r\n  \r\n  const fetchUserLocations = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n      \r\n      const response = await axios.get(\r\n        getApiUrl(api.endpoints.adminUserLocations),\r\n        { headers: { Authorization: `Bearer ${user.token}` } }\r\n      );\r\n      \r\n      if (response.data && Array.isArray(response.data)) {\r\n        console.log('User locations loaded:', response.data.length);\r\n        setRawLocations(response.data);\r\n        setLastRefresh(new Date());\r\n        \r\n        if (response.data.length > 0 && mapRef.current) {\r\n          // Find a suitable center point for the map\r\n          const validLocations = response.data.filter(\r\n            loc => loc && loc.latitude && loc.longitude\r\n          );\r\n          \r\n          if (validLocations.length > 0) {\r\n            const firstLocation = validLocations[0];\r\n            setMapCenter([\r\n              firstLocation.latitude || firstLocation.coordinates?.latitude, \r\n              firstLocation.longitude || firstLocation.coordinates?.longitude\r\n            ]);\r\n          }\r\n        }\r\n      } else {\r\n        console.warn(\"Unexpected response format:\", response.data);\r\n        setRawLocations([]);\r\n      }\r\n    } catch (err) {\r\n      setError('Failed to fetch user locations: ' + err.message);\r\n      console.error('Error fetching user locations:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Initial fetch\r\n  useEffect(() => {\r\n    fetchUserLocations();\r\n    \r\n    // Set up refresh interval - refresh every 30 seconds\r\n    const interval = setInterval(fetchUserLocations, 30000);\r\n    \r\n    // Clean up interval on unmount\r\n    return () => {\r\n      if (interval) {\r\n        clearInterval(interval);\r\n      }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [user.token]); \r\n  \r\n  // Filter locations based on search text - ensure we check all possible fields\r\n  const filteredLocations = locations.filter(location => {\r\n    const searchText = filterText.toLowerCase();\r\n    \r\n    // Check all possible name/identifier fields in the data\r\n    return (\r\n      (location.username?.toLowerCase() || '').includes(searchText) ||\r\n      (location.user_name?.toLowerCase() || '').includes(searchText) ||\r\n      (location.email?.toLowerCase() || '').includes(searchText) ||\r\n      (location.fullName?.toLowerCase() || '').includes(searchText) ||\r\n      (location.role?.toLowerCase() || '').includes(searchText) ||\r\n      (location.type?.toLowerCase() || '').includes(searchText)\r\n    );\r\n  });\r\n  \r\n  // Calculate statistics with better role detection\r\n  const userCounts = {\r\n    total: filteredLocations.length,\r\n    drivers: filteredLocations.filter(loc => {\r\n      const role = loc.role || loc.type || '';\r\n      return role.toLowerCase() === 'driver';\r\n    }).length,\r\n    users: filteredLocations.filter(loc => {\r\n      const role = loc.role || loc.type || '';\r\n      return role.toLowerCase() === 'user' || role === '';\r\n    }).length,\r\n    admins: filteredLocations.filter(loc => {\r\n      const role = loc.role || loc.type || '';\r\n      return role.toLowerCase() === 'admin';\r\n    }).length\r\n  };\r\n  \r\n  // Format timestamp in a readable way\r\n  const formatTimestamp = (timestamp) => {\r\n    if (!timestamp) return 'Unknown';\r\n    \r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffMinutes = Math.floor((now - date) / (1000 * 60));\r\n    \r\n    if (diffMinutes < 1) return 'Just now';\r\n    if (diffMinutes < 60) return `${diffMinutes} minute${diffMinutes === 1 ? '' : 's'} ago`;\r\n    \r\n    const diffHours = Math.floor(diffMinutes / 60);\r\n    if (diffHours < 24) return `${diffHours} hour${diffHours === 1 ? '' : 's'} ago`;\r\n    \r\n    const diffDays = Math.floor(diffHours / 24);\r\n    if (diffDays < 7) return `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;\r\n    \r\n    return date.toLocaleDateString() + ' at ' + date.toLocaleTimeString();\r\n  };\r\n  \r\n  // Get the right marker coordinates regardless of data format\r\n  const getMarkerCoordinates = (location) => {\r\n    // Handle different possible data formats\r\n    if (location.coordinates) {\r\n      return [\r\n        location.coordinates.latitude || location.coordinates.lat,\r\n        location.coordinates.longitude || location.coordinates.lng\r\n      ];\r\n    } else {\r\n      return [location.latitude, location.longitude];\r\n    }\r\n  };\r\n  \r\n  // Get the status of the location based on timestamp\r\n  const getLocationStatus = (timestamp) => {\r\n    if (!timestamp) return 'unknown';\r\n    \r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffMinutes = Math.floor((now - date) / (1000 * 60));\r\n    \r\n    if (diffMinutes < 15) return 'active';\r\n    if (diffMinutes < 60) return 'recent';\r\n    if (diffMinutes < 24 * 60) return 'today';\r\n    return 'old';\r\n  };\r\n  \r\n  // Get the right user role regardless of data format\r\n  const getUserRole = (location) => {\r\n    const role = location.role || location.type || 'user';\r\n    return role.toLowerCase();\r\n  };\r\n  \r\n  if (loading && locations.length === 0) {\r\n    return <div>Loading user locations...</div>;\r\n  }\r\n  \r\n  return (\r\n    <div className=\"user-locations\">\r\n      <h2>User Location Tracking</h2>\r\n      {error && <div className=\"error-message\">{error}</div>}\r\n      \r\n      <div className=\"action-buttons\">\r\n        <button \r\n          onClick={fetchUserLocations} \r\n          disabled={loading} \r\n          className=\"refresh-button\"\r\n        >\r\n          {loading ? 'Refreshing...' : 'Refresh Data'}\r\n        </button>\r\n      </div>\r\n      \r\n      <div className=\"last-updated\">\r\n        Last updated: {formatTimestamp(lastRefresh)}\r\n      </div>\r\n      \r\n      <div className=\"filter-container\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by name, email or type...\"\r\n          value={filterText}\r\n          onChange={e => setFilterText(e.target.value)}\r\n        />\r\n      </div>\r\n      \r\n      {/* <div className=\"user-stats\">\r\n        <div className=\"stat-box\">\r\n          <span className=\"stat-value\">{userCounts.total}</span>\r\n          <span className=\"stat-label\">Total Users</span>\r\n        </div>\r\n        <div className=\"stat-box\">\r\n          <span className=\"stat-value\">{userCounts.drivers}</span>\r\n          <span className=\"stat-label\">Drivers</span>\r\n        </div>\r\n        <div className=\"stat-box\">\r\n          <span className=\"stat-value\">{userCounts.users}</span>\r\n          <span className=\"stat-label\">Passengers</span>\r\n        </div>\r\n        <div className=\"stat-box\">\r\n          <span className=\"stat-value\">{userCounts.admins}</span>\r\n          <span className=\"stat-label\">Admins</span>\r\n        </div>\r\n      </div> */}\r\n      \r\n      {filteredLocations.length > 0 ? (\r\n        <div className=\"map-container\">\r\n          <MapContainer\r\n            center={mapCenter}\r\n            zoom={15}\r\n            style={{ height: \"500px\", width: \"100%\" }}\r\n            ref={mapRef}\r\n          >\r\n            <TileLayer\r\n              attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n            />\r\n            \r\n            {filteredLocations.map(location => {\r\n              const role = getUserRole(location);\r\n              const coordinates = getMarkerCoordinates(location);\r\n              \r\n              // Only show marker if we have valid coordinates\r\n              if (coordinates[0] && coordinates[1] && \r\n                  !isNaN(coordinates[0]) && !isNaN(coordinates[1])) {\r\n                return (\r\n                  <Marker\r\n                    key={location.id || location.user_id || location._id}\r\n                    position={coordinates}\r\n                    icon={createIcon(role)}\r\n                  >\r\n                    <Popup>\r\n                      <div className=\"location-popup\">\r\n                        <strong>{location.username || location.user_name || 'Unknown User'}</strong>\r\n                        <p>Role: {role}</p>\r\n                        <p>Last seen: {formatTimestamp(location.timestamp)}</p>\r\n                        <p>Coordinates: {coordinates[0].toFixed(6)}, {coordinates[1].toFixed(6)}</p>\r\n                      </div>\r\n                    </Popup>\r\n                  </Marker>\r\n                );\r\n              }\r\n              return null;\r\n            })}\r\n          </MapContainer>\r\n        </div>\r\n      ) : (\r\n        <div className=\"no-locations\">\r\n          <p>No user locations found matching your search criteria.</p>\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"users-table\">\r\n        <h3>User Location Details {filteredLocations.length > 0 && `(${filteredLocations.length})`}</h3>\r\n        {filteredLocations.length === 0 ? (\r\n          <p>No user locations found matching your search criteria.</p>\r\n        ) : (\r\n          <table>\r\n            <thead>\r\n              <tr>\r\n                <th>Username</th>\r\n                <th>Email</th>\r\n                <th>Role</th>\r\n                <th>Last Updated</th>\r\n                <th>Status</th>\r\n                <th>Coordinates</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filteredLocations.map(location => {\r\n                const role = getUserRole(location);\r\n                const coordinates = getMarkerCoordinates(location);\r\n                const status = getLocationStatus(location.timestamp);\r\n                \r\n                return (\r\n                  <tr key={location.id || location.user_id || location._id} \r\n                      className={`status-${status} role-${role}`}>\r\n                    <td>{location.username || location.user_name || 'Unknown'}</td>\r\n                    <td>{location.email || location.fullName || 'Not provided'}</td>\r\n                    <td>\r\n                      <span className={`role-badge role-${role}`}>{role}</span>\r\n                    </td>\r\n                    <td>{formatTimestamp(location.timestamp)}</td>\r\n                    <td>\r\n                      <span className={`status-indicator ${status}`}>\r\n                        {status === 'active' ? 'Active now' : \r\n                         status === 'recent' ? 'Recently active' :\r\n                         status === 'today' ? 'Active today' : 'Not recent'}\r\n                      </span>\r\n                    </td>\r\n                    <td>\r\n                      {coordinates[0] && coordinates[1] ? \r\n                        `${coordinates[0].toFixed(6)}, ${coordinates[1].toFixed(6)}` : \r\n                        'Invalid coordinates'}\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UserLocations;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}